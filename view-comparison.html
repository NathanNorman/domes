<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dome Wing Pitch Comparison</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f5f5f0;
    color: #333;
    min-height: 100vh;
}
header {
    background: #2c3e50;
    color: white;
    padding: 16px 24px;
    text-align: center;
}
header h1 { font-size: 1.4rem; font-weight: 600; margin-bottom: 4px; }
header p { font-size: 0.85rem; opacity: 0.8; }
.container { max-width: 1400px; margin: 0 auto; padding: 20px; }
.panels {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
}
.panel {
    flex: 1 1 500px;
    max-width: 680px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    padding: 16px;
}
.panel h2 {
    font-size: 1.1rem;
    color: #2c3e50;
    margin-bottom: 10px;
    text-align: center;
}
canvas {
    width: 100%;
    height: auto;
    display: block;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    background: #fff;
}
.slider-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 12px;
    padding: 0 4px;
}
.slider-row label { font-size: 0.9rem; font-weight: 500; white-space: nowrap; }
.slider-row input[type=range] { flex: 1; accent-color: #2c3e50; }
.slider-row .value {
    font-size: 0.95rem;
    font-weight: 600;
    min-width: 48px;
    text-align: right;
    font-variant-numeric: tabular-nums;
}
.delta-section {
    margin-top: 24px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    padding: 16px 20px;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
}
.delta-section h2 {
    font-size: 1.1rem;
    color: #2c3e50;
    margin-bottom: 12px;
    text-align: center;
}
.delta-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}
.delta-header h2 { margin-bottom: 0; }
.swap-btn {
    background: #2c3e50;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 14px;
    font-size: 0.85rem;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.15s;
}
.swap-btn:hover { background: #3d566e; }
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
}
th {
    text-align: left;
    padding: 8px 10px;
    border-bottom: 2px solid #2c3e50;
    font-weight: 600;
    color: #2c3e50;
}
th:not(:first-child) { text-align: right; }
td {
    padding: 7px 10px;
    border-bottom: 1px solid #eee;
}
td:not(:first-child) { text-align: right; font-variant-numeric: tabular-nums; }
td.diff-neg { color: #27ae60; font-weight: 600; }
td.diff-pos { color: #c0392b; font-weight: 600; }
td.diff-zero { color: #888; }
@media (max-width: 768px) {
    .panels { flex-direction: column; align-items: center; }
    .panel { max-width: 100%; }
}
</style>
</head>
<body>
<header>
    <h1>Wing Pitch Comparison</h1>
    <p>Side-by-side cross-sections at different roof pitch angles</p>
</header>
<div class="container">
    <div class="panels">
        <div class="panel">
            <h2>Pitch A</h2>
            <canvas id="canvasA" width="1200" height="540"></canvas>
            <div class="slider-row">
                <label for="sliderA">Pitch A:</label>
                <input type="range" id="sliderA" min="10" max="45" step="0.5" value="20">
                <span class="value" id="valA">20.0&deg;</span>
            </div>
        </div>
        <div class="panel">
            <h2>Pitch B</h2>
            <canvas id="canvasB" width="1200" height="540"></canvas>
            <div class="slider-row">
                <label for="sliderB">Pitch B:</label>
                <input type="range" id="sliderB" min="10" max="45" step="0.5" value="25">
                <span class="value" id="valB">25.0&deg;</span>
            </div>
        </div>
    </div>
    <div class="delta-section">
        <div class="delta-header">
            <h2>Comparison</h2>
            <button class="swap-btn" id="swapBtn">&#8646; Swap</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Pitch A</th>
                    <th>Pitch B</th>
                    <th>Difference</th>
                </tr>
            </thead>
            <tbody id="deltaBody"></tbody>
        </table>
    </div>
</div>
<script>
// --- Constants ---
const LEFT_WALL_H = 20.0;
const RIGHT_POST_H = 8.0;
const ROOF_DROP = 12.0;
const INTERIOR_WALL_H = 12.0;

// --- Geometry ---
function computeGeometry(pitchDeg) {
    const rad = pitchDeg * Math.PI / 180;
    const horizSpan = ROOF_DROP / Math.tan(rad);
    const wallX = RIGHT_POST_H / Math.tan(rad);
    const rafterLen = ROOF_DROP / Math.sin(rad);
    const rightSection = horizSpan - wallX;
    return { pitchDeg, rad, horizSpan, wallX, rafterLen, rightSection };
}

// --- Fixed world bounds ---
const WORLD = { xMin: -3, xMax: 37, yMin: -5, yMax: 22 };

// --- Drawing ---
function drawCrossSection(canvas, geo) {
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;
    const dpr = window.devicePixelRatio || 1;

    // Scale canvas for retina
    if (canvas.getAttribute('data-scaled') !== 'true') {
        canvas.width = W * dpr;
        canvas.height = H * dpr;
        canvas.style.width = W + 'px';
        canvas.style.height = H + 'px';
        canvas.setAttribute('data-scaled', 'true');
    }
    const cw = canvas.width;
    const ch = canvas.height;
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.clearRect(0, 0, cw, ch);

    const worldW = WORLD.xMax - WORLD.xMin;
    const worldH = WORLD.yMax - WORLD.yMin;
    const scaleX = cw / worldW;
    const scaleY = ch / worldH;
    const scale = Math.min(scaleX, scaleY);
    const offX = (cw - worldW * scale) / 2 - WORLD.xMin * scale;
    const offY = (ch + worldH * scale) / 2 + WORLD.yMin * scale;

    function tx(x) { return offX + x * scale; }
    function ty(y) { return offY - y * scale; }

    // --- Grid ---
    ctx.save();
    // minor grid (1')
    ctx.strokeStyle = '#f0f0f0';
    ctx.lineWidth = 0.5;
    for (let x = Math.ceil(WORLD.xMin); x <= WORLD.xMax; x++) {
        ctx.beginPath(); ctx.moveTo(tx(x), ty(WORLD.yMin)); ctx.lineTo(tx(x), ty(WORLD.yMax)); ctx.stroke();
    }
    for (let y = Math.ceil(WORLD.yMin); y <= WORLD.yMax; y++) {
        ctx.beginPath(); ctx.moveTo(tx(WORLD.xMin), ty(y)); ctx.lineTo(tx(WORLD.xMax), ty(y)); ctx.stroke();
    }
    // major grid (5')
    ctx.strokeStyle = '#ddd';
    ctx.lineWidth = 1;
    for (let x = Math.ceil(WORLD.xMin / 5) * 5; x <= WORLD.xMax; x += 5) {
        ctx.beginPath(); ctx.moveTo(tx(x), ty(WORLD.yMin)); ctx.lineTo(tx(x), ty(WORLD.yMax)); ctx.stroke();
    }
    for (let y = Math.ceil(WORLD.yMin / 5) * 5; y <= WORLD.yMax; y += 5) {
        ctx.beginPath(); ctx.moveTo(tx(WORLD.xMin), ty(y)); ctx.lineTo(tx(WORLD.xMax), ty(y)); ctx.stroke();
    }
    ctx.restore();

    // --- Ground line ---
    ctx.save();
    ctx.strokeStyle = '#8B7355';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(tx(WORLD.xMin), ty(0));
    ctx.lineTo(tx(WORLD.xMax), ty(0));
    ctx.stroke();
    ctx.restore();

    // Key points
    const pts = {
        leftBase: [0, 0],
        leftTop: [0, LEFT_WALL_H],
        rightBase: [geo.horizSpan, 0],
        rightTop: [geo.horizSpan, RIGHT_POST_H],
        wallBase: [geo.wallX, 0],
        wallTop: [geo.wallX, INTERIOR_WALL_H],
    };

    // --- Structure ---
    ctx.save();
    ctx.strokeStyle = '#2c3e50';
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';

    // Left wall
    ctx.beginPath();
    ctx.moveTo(tx(pts.leftBase[0]), ty(pts.leftBase[1]));
    ctx.lineTo(tx(pts.leftTop[0]), ty(pts.leftTop[1]));
    ctx.stroke();

    // Right post
    ctx.beginPath();
    ctx.moveTo(tx(pts.rightBase[0]), ty(pts.rightBase[1]));
    ctx.lineTo(tx(pts.rightTop[0]), ty(pts.rightTop[1]));
    ctx.stroke();

    // Interior wall
    ctx.strokeStyle = '#7f8c8d';
    ctx.lineWidth = 2.5;
    ctx.setLineDash([8, 4]);
    ctx.beginPath();
    ctx.moveTo(tx(pts.wallBase[0]), ty(pts.wallBase[1]));
    ctx.lineTo(tx(pts.wallTop[0]), ty(pts.wallTop[1]));
    ctx.stroke();
    ctx.setLineDash([]);

    // Roof line
    ctx.strokeStyle = '#c0392b';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(tx(pts.leftTop[0]), ty(pts.leftTop[1]));
    ctx.lineTo(tx(pts.rightTop[0]), ty(pts.rightTop[1]));
    ctx.stroke();
    ctx.restore();

    // --- X marks at joints ---
    function drawX(x, y, sz) {
        ctx.save();
        ctx.strokeStyle = '#e74c3c';
        ctx.lineWidth = 2;
        var s = sz * scale / 2;
        var cx = tx(x), cy = ty(y);
        ctx.beginPath(); ctx.moveTo(cx - s, cy - s); ctx.lineTo(cx + s, cy + s); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(cx + s, cy - s); ctx.lineTo(cx - s, cy + s); ctx.stroke();
        ctx.restore();
    }
    drawX(pts.leftBase[0], pts.leftBase[1], 0.6);
    drawX(pts.leftTop[0], pts.leftTop[1], 0.6);
    drawX(pts.rightBase[0], pts.rightBase[1], 0.6);
    drawX(pts.rightTop[0], pts.rightTop[1], 0.6);
    drawX(pts.wallBase[0], pts.wallBase[1], 0.6);
    drawX(pts.wallTop[0], pts.wallTop[1], 0.6);

    // --- Dimension arrows ---
    var fontSize = Math.max(11, 13 * scale / 30);
    ctx.font = '600 ' + fontSize + 'px -apple-system, BlinkMacSystemFont, sans-serif';

    function dimVert(x, y0, y1, label, side) {
        // side: -1 = left, 1 = right
        var off = side * 1.8;
        var ax = tx(x + off), ay0 = ty(y0), ay1 = ty(y1);
        ctx.save();
        ctx.strokeStyle = '#555';
        ctx.fillStyle = '#555';
        ctx.lineWidth = 1.2;
        // Line
        ctx.beginPath(); ctx.moveTo(ax, ay0); ctx.lineTo(ax, ay1); ctx.stroke();
        // Arrowheads
        var aw = 4, ah = 8;
        ctx.beginPath(); ctx.moveTo(ax, ay0); ctx.lineTo(ax - aw, ay0 + ah); ctx.lineTo(ax + aw, ay0 + ah); ctx.closePath(); ctx.fill();
        ctx.beginPath(); ctx.moveTo(ax, ay1); ctx.lineTo(ax - aw, ay1 - ah); ctx.lineTo(ax + aw, ay1 - ah); ctx.closePath(); ctx.fill();
        // Tick marks
        var tw = 4 * side;
        ctx.beginPath(); ctx.moveTo(ax - tw, ay0); ctx.lineTo(ax + tw, ay0); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(ax - tw, ay1); ctx.lineTo(ax + tw, ay1); ctx.stroke();
        // Label
        ctx.textAlign = side < 0 ? 'right' : 'left';
        ctx.textBaseline = 'middle';
        ctx.fillText(label, ax + side * 6, (ay0 + ay1) / 2);
        ctx.restore();
    }

    function dimHoriz(y, x0, x1, label, side) {
        // side: -1 = above, 1 = below
        var off = side * 1.6;
        var ay = ty(y + off), ax0 = tx(x0), ax1 = tx(x1);
        ctx.save();
        ctx.strokeStyle = '#555';
        ctx.fillStyle = '#555';
        ctx.lineWidth = 1.2;
        ctx.beginPath(); ctx.moveTo(ax0, ay); ctx.lineTo(ax1, ay); ctx.stroke();
        var aw = 4, ah = 8;
        ctx.beginPath(); ctx.moveTo(ax0, ay); ctx.lineTo(ax0 + ah, ay - aw); ctx.lineTo(ax0 + ah, ay + aw); ctx.closePath(); ctx.fill();
        ctx.beginPath(); ctx.moveTo(ax1, ay); ctx.lineTo(ax1 - ah, ay - aw); ctx.lineTo(ax1 - ah, ay + aw); ctx.closePath(); ctx.fill();
        var tw = 4 * side;
        ctx.beginPath(); ctx.moveTo(ax0, ay - tw); ctx.lineTo(ax0, ay + tw); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(ax1, ay - tw); ctx.lineTo(ax1, ay + tw); ctx.stroke();
        ctx.textAlign = 'center';
        ctx.textBaseline = side < 0 ? 'bottom' : 'top';
        ctx.fillText(label, (ax0 + ax1) / 2, ay + side * 8);
        ctx.restore();
    }

    // Left wall height
    dimVert(0, 0, LEFT_WALL_H, LEFT_WALL_H.toFixed(0) + "'", -1);
    // Right post height
    dimVert(geo.horizSpan, 0, RIGHT_POST_H, RIGHT_POST_H.toFixed(0) + "'", 1);
    // Interior wall height
    dimVert(geo.wallX, 0, INTERIOR_WALL_H, INTERIOR_WALL_H.toFixed(0) + "'", 1);
    // Total horizontal span
    dimHoriz(0, 0, geo.horizSpan, geo.horizSpan.toFixed(1) + "'", 1);
    // Extension distance (wallX to horizSpan)
    dimHoriz(RIGHT_POST_H, geo.wallX, geo.horizSpan, geo.rightSection.toFixed(1) + "'", -1);

    // --- Pitch angle arc ---
    ctx.save();
    var arcR = 3.5 * scale;
    var cx = tx(0), cy = ty(LEFT_WALL_H);
    ctx.strokeStyle = '#2980b9';
    ctx.lineWidth = 2;
    // Roof goes down-right from left top
    // Angle measured from horizontal (pointing right)
    // The roof line goes at -pitchDeg below horizontal
    var startAngle = 0; // horizontal right
    var endAngle = geo.rad; // down by pitch degrees
    // In canvas coords, positive Y is down, so angle below horizontal is positive
    ctx.beginPath();
    ctx.arc(cx, cy, arcR, startAngle, endAngle, false);
    ctx.stroke();
    // Label
    ctx.fillStyle = '#2980b9';
    ctx.font = '600 ' + fontSize + 'px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.textAlign = 'left';
    ctx.textBaseline = 'middle';
    var labelAngle = endAngle / 2;
    ctx.fillText(geo.pitchDeg.toFixed(1) + '\u00B0', cx + (arcR + 8) * Math.cos(labelAngle), cy + (arcR + 8) * Math.sin(labelAngle));
    ctx.restore();

    // --- Rafter length label along roof ---
    ctx.save();
    var mx = (pts.leftTop[0] + pts.rightTop[0]) / 2;
    var my = (pts.leftTop[1] + pts.rightTop[1]) / 2;
    ctx.fillStyle = '#c0392b';
    ctx.font = '600 ' + fontSize + 'px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'bottom';
    // Position label above midpoint of roof
    var nx = Math.sin(geo.rad);
    var ny = Math.cos(geo.rad);
    ctx.fillText('Rafter: ' + geo.rafterLen.toFixed(1) + "'", tx(mx) + nx * 14, ty(my) - ny * 4 - 6);
    ctx.restore();

    // --- Labels ---
    ctx.save();
    ctx.fillStyle = '#7f8c8d';
    ctx.font = '500 ' + (fontSize * 0.85) + 'px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    ctx.fillText('Dome Wall', tx(0), ty(-0.5) + 4);
    ctx.fillText('Post', tx(geo.horizSpan), ty(-0.5) + 4);
    ctx.fillText('Int. Wall', tx(geo.wallX), ty(-0.5) + 4);
    ctx.restore();
}

// --- Delta table ---
function updateDelta(geoA, geoB) {
    var body = document.getElementById('deltaBody');
    var metrics = [
        { name: 'Wing Room (wallX)', a: geoA.wallX, b: geoB.wallX },
        { name: 'Extension', a: geoA.rightSection, b: geoB.rightSection },
        { name: 'Total Span', a: geoA.horizSpan, b: geoB.horizSpan },
        { name: 'Rafter Length', a: geoA.rafterLen, b: geoB.rafterLen },
    ];
    var html = '';
    for (var i = 0; i < metrics.length; i++) {
        var m = metrics[i];
        var diff = m.b - m.a;
        var cls = diff < -0.05 ? 'diff-neg' : diff > 0.05 ? 'diff-pos' : 'diff-zero';
        var sign = diff > 0.05 ? '+' : '';
        html += '<tr>'
            + '<td>' + m.name + '</td>'
            + '<td>' + m.a.toFixed(1) + "'</td>"
            + '<td>' + m.b.toFixed(1) + "'</td>"
            + '<td class="' + cls + '">' + sign + diff.toFixed(1) + "'</td>"
            + '</tr>';
    }
    body.innerHTML = html;
}

// --- Main ---
var sliderA = document.getElementById('sliderA');
var sliderB = document.getElementById('sliderB');
var valA = document.getElementById('valA');
var valB = document.getElementById('valB');
var canvasA = document.getElementById('canvasA');
var canvasB = document.getElementById('canvasB');

function update() {
    var pitchA = parseFloat(sliderA.value);
    var pitchB = parseFloat(sliderB.value);
    valA.innerHTML = pitchA.toFixed(1) + '&deg;';
    valB.innerHTML = pitchB.toFixed(1) + '&deg;';
    var geoA = computeGeometry(pitchA);
    var geoB = computeGeometry(pitchB);
    drawCrossSection(canvasA, geoA);
    drawCrossSection(canvasB, geoB);
    updateDelta(geoA, geoB);
}

sliderA.addEventListener('input', update);
sliderB.addEventListener('input', update);

document.getElementById('swapBtn').addEventListener('click', function() {
    var tmp = sliderA.value;
    sliderA.value = sliderB.value;
    sliderB.value = tmp;
    update();
});

// Handle resize for retina
window.addEventListener('resize', function() {
    canvasA.removeAttribute('data-scaled');
    canvasB.removeAttribute('data-scaled');
    canvasA.width = 1200;
    canvasA.height = 540;
    canvasB.width = 1200;
    canvasB.height = 540;
    update();
});

// Listen for pitch changes from parent (iframe sync) â€” sets Pitch A
window.addEventListener('message', function(e) {
  if (e.data && e.data.type === 'setPitch') {
    var v = parseFloat(e.data.value);
    if (v >= 10 && v <= 45) { sliderA.value = v; update(); }
  }
});

update();
</script>
</body>
</html>
